// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.28.0
// source: message_history.sql

package gen

import (
	"context"

	"github.com/google/uuid"
	"github.com/jackc/pgx/v5/pgtype"
)

const createMessageHistory = `-- name: CreateMessageHistory :one
INSERT INTO message_history (message_id, message_type, status, payload, error_message, processing_duration_ms)
VALUES ($1, $2, $3, $4, $5, $6)
RETURNING id, message_id, message_type, status, payload, error_message, processing_duration_ms, created_at
`

type CreateMessageHistoryParams struct {
	MessageID            uuid.UUID   `json:"message_id"`
	MessageType          string      `json:"message_type"`
	Status               string      `json:"status"`
	Payload              []byte      `json:"payload"`
	ErrorMessage         pgtype.Text `json:"error_message"`
	ProcessingDurationMs pgtype.Int4 `json:"processing_duration_ms"`
}

func (q *Queries) CreateMessageHistory(ctx context.Context, db DBTX, arg CreateMessageHistoryParams) (*MessageHistory, error) {
	row := db.QueryRow(ctx, createMessageHistory,
		arg.MessageID,
		arg.MessageType,
		arg.Status,
		arg.Payload,
		arg.ErrorMessage,
		arg.ProcessingDurationMs,
	)
	var i MessageHistory
	err := row.Scan(
		&i.ID,
		&i.MessageID,
		&i.MessageType,
		&i.Status,
		&i.Payload,
		&i.ErrorMessage,
		&i.ProcessingDurationMs,
		&i.CreatedAt,
	)
	return &i, err
}

const getMessageDetailsForHistory = `-- name: GetMessageDetailsForHistory :one
SELECT message_type, payload FROM message_queue
WHERE id = $1
`

type GetMessageDetailsForHistoryRow struct {
	MessageType string `json:"message_type"`
	Payload     []byte `json:"payload"`
}

func (q *Queries) GetMessageDetailsForHistory(ctx context.Context, db DBTX, id uuid.UUID) (*GetMessageDetailsForHistoryRow, error) {
	row := db.QueryRow(ctx, getMessageDetailsForHistory, id)
	var i GetMessageDetailsForHistoryRow
	err := row.Scan(&i.MessageType, &i.Payload)
	return &i, err
}

const getMessageHistory = `-- name: GetMessageHistory :many
SELECT id, message_id, message_type, status, payload, error_message, processing_duration_ms, created_at FROM message_history
WHERE message_id = $1
ORDER BY created_at DESC
LIMIT $2
`

type GetMessageHistoryParams struct {
	MessageID uuid.UUID `json:"message_id"`
	Limit     int32     `json:"limit"`
}

func (q *Queries) GetMessageHistory(ctx context.Context, db DBTX, arg GetMessageHistoryParams) ([]*MessageHistory, error) {
	rows, err := db.Query(ctx, getMessageHistory, arg.MessageID, arg.Limit)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []*MessageHistory
	for rows.Next() {
		var i MessageHistory
		if err := rows.Scan(
			&i.ID,
			&i.MessageID,
			&i.MessageType,
			&i.Status,
			&i.Payload,
			&i.ErrorMessage,
			&i.ProcessingDurationMs,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, &i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}
